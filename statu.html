<!DOCTYPE html>
  <html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <title>Statistiques  des étudiants THYP 2019-2020</title>
    <script src='//d3js.org/d3.v5.min.js'></script>
    <style>
        html, body, #wrapper{
            height:'100%';
            width:'100%';
        }
    </style>
  </head>
  <body>
      <h1>Statistiques des étudiants THYP 2019-2020</h1>
    <div id='wrapper'>

    </div>
    <div id="chartpie"></div>

    <script>
    var urlData = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRPYNknmIr5_bU7GfiJtuS_b9fGae7HZwcjAiMoAC24fLzIfxRtXQySMu3E95D3M595D3DYT7NUtvzt/pub?gid=760811187&single=true&output=csv';
    var competence = ["analyser des bases de données" , "connaître les base du langage HTML 5", "connaître les bases du responsive web design (RWD)", 
	"connaître les outils d’édition web (éditeurs html, CSS, …)",
	"savoir faire fonctionner, sur un site, un service de type « e-commerce » (vente de produits, …)", 
	"savoir gérer la publication à distance d’un site web", 
	"savoir gérer un projet" , 
	"savoir gérer un site multilingue",
     "savoir gérer une communauté en ligne",
     "savoir intégrer, dans un page, des outils de diffusion web 2 (twitter, facebook, …)",
     "savoir mettre en place des enquêtes enligne",
     "savoir mettre en place des outils de type « ranking »",
     "savoir mettre en place et exploiter des outils de veille d’information",
     "savoir mettre en place et gérer un forum de discussion",
     "savoir mettre en place et gérer un service de type « newsletter » (impliquant la mise en place et la gestion d’un annuaire d’abonnés)",
     "savoir prototyper des innovations numériques",
     "savoir réaliser des podcasts",
     "savoir réaliser et diffuser des e-publications : brochures, dépliants, publications multimédias, …",
     "savoir scénariser et réaliser des rubriques multimédias (« page vidéo », « page photo », exposition virtuelle, …)",
    "savoir scénariser et réaliser les rubriques « statiques » d’un site web",
    "savoir travailler avec le RSS",
    "savoir utiliser correctement les métadonnées pour une meilleure diffusion des contenus du site",
    "savoir utiliser des cartes géographiques interactives",
     "savoir utiliser des outils de gestion d’accès aux rubriques (accès par mot de passe, …)",
    "savoir utiliser les programmes de liens sponsorisés",
    "utiliser les méthodes agiles de développement"];
    d3.csv(urlData)
        .then(function(data) {
            console.log(data);
    keys=["je ne connais pas de tout ","je connais bien","je suis expert(e)","Pas besoin","Besoin d'approfondissement","Besoin urgent"]
            var competence1 = d3.select('#wrapper').append('svg')
                
            competence1.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "lightgrey");
                //.append ( " je ne connais pas du tout:1 " );
               var text1= competence1.append("text");

               text1.attr("x",20).attr("y",20);
               text1.text("je ne connais pas de tout :1");

                var competence2 = d3.select('#wrapper').append('svg')
            competence2.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "grey");
                //.append ( " je connais bien:2 " );
                var text2= competence2.append("text");

               text2.attr("x",20).attr("y",20);
               text2.text("je connais bien:2");
                var competence3 = d3.select('#wrapper').append('svg')
            competence3.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "purple");
               //.append ( " je suis expert(e):3 " );
               var text3= competence3.append("text");

                text3.attr("x",20).attr("y",20);
               text3.text("je suis expert(e) :3");
            
                var besoin1 = d3.select('#wrapper').append('svg')
                 besoin1.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "brown");
                var text4= besoin1.append("text");

               text4.attr("x",20).attr("y",20);
               text4.text("Pas besoin :4");
                var besoin2 = d3.select('#wrapper').append('svg')
            besoin2.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "yellow");
                var text5= besoin2.append("text");

               text5.attr("x",20).attr("y",20);
               text5.text("Besoin d'approfondissement :5");

                var besoin3 = d3.select('#wrapper').append('svg')
            besoin3.selectAll("rect").data(data).enter().append("rect")
                .attr("x",1)            
                .attr("y",1)
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", "red");
                var text6= besoin3.append("text");

              text6.attr("x",20).attr("y",20);
               text6.text("Besoin urgent:6");

            var div = d3.select('#wrapper').append('div')
                .attr('height','100%')
                .attr('width','100%');
            div.selectAll('div').data(data).enter().append('div')
                .html(function(d,i){
                    return d['Votre nom'] +" "+d['Votre prénom'];
                });
            
            
            
        })
        .catch(function(error){
            console.log(error);
        });
    
    
      function renderChart (wrapper, curData) {
        if (!wrapper) {
          return
        }
        const { select: d3Select, pie: d3Pie,
          arc: d3Arc, interpolate: d3Interpolate,
          easeBounce: d3EaseBounce, easeElastic: d3EaseElastic,
        } = d3
        const width = 500
        const height = 500
        const DURATION = 1500
        
        const svgData = d3Select(wrapper).selectAll('svg').data(['competence'])
        const svgEnter = svgData.enter().append('svg')
        svgEnter.attr('width', width)
        svgEnter.attr('height', height)
        svgEnter.append('g')
          .attr('transform', `translate(${width / 2},${height / 2})`)
          .attr('class', 'donut-chart')
        const svgMerge = svgData.merge(svgEnter)
        const gMerge = svgMerge.select('g.donut-chart')
        const pieChart = d3Pie().sort(null).value(pd => pd.value) // by default, data sorts in descending value. this will mess with our animation so we set it to null
        const radius = Math.min(width, height) / 2
        const arcPath = d3Arc()
          .outerRadius(radius - radius * 0.1)
          .innerRadius(radius - radius * 0.5)
        const arcLabel = d3Arc()
          .outerRadius(radius - radius * 0.1)
          .innerRadius(radius - radius * 0.4)
        const pieData = gMerge.selectAll('.pie-slice').data(pieChart(curData))
        const pieEnter = pieData.enter()
          .append('g')
          .attr('class', 'pie-slice')
        pieEnter.append('path')
          .attr('fill', d => d.data.fill)
          .attr('d', arcPath)
          .each(function () {
            this._current = { startAngle: 0, endAngle: 0 }
          })
        pieEnter.append('g')
          .attr('class', 'label-text-wrapper')
          .append('text')
          .text(d => d.data.label)
        const pieMerge = pieData.merge(pieEnter)
        pieMerge.select('.label-text-wrapper')
          .transition()
          .duration( DURATION )
          .attr('transform', (d) => `translate(${arcLabel.centroid(d)})`)
        pieMerge.select('text')
          .transition()
          .duration( DURATION )
          .tween('text', function (d) {
            const textI = d3Interpolate(this.textContent, d.data.label)
            return (t) => {
              this.textContent = textI(t)
            }
          })
        pieMerge.select('path')
          .transition()
          .duration( DURATION )
          .attrTween('d', function (d) {
            const _interpolate = d3Interpolate( this._current, d )
            this._current = _interpolate( 0 )
            return (t) => {
              return arcPath( _interpolate( t ) )
            }
          })
        const pathAnimate = (path, dir) => {
          switch(dir) {
            case 0:
              path.transition()
                .duration(DURATION / 2)
                .ease(d3EaseBounce)
                .attr('d', d3Arc()
                  .outerRadius(radius - radius * 0.1)
                  .innerRadius(radius - radius * 0.5)
                )
              break;
            case 1:
              path.transition()
                .duration(DURATION / 2)
                .ease(d3EaseElastic)
                .attr('d', d3Arc()
                  .outerRadius(radius - radius * 0.05)
                  .innerRadius(radius - radius * 0.6)
                )
              break;
          }
        }
        const tooltipData = d3Select(wrapper)
          .selectAll('div').data(['competence'])
        const tooltipEnter = tooltipData.enter()
          .append('div')
          .attr('class', 'tooltip')
          .style('background', '#ffffff')
          .style('color', '#000000')
          .style('display', 'none')
          .style('top', 0)
          .style('left', 0)
          .style('padding', '10px')
          .style('position', 'absolute')
        const tooltipMerge = tooltipData.merge(tooltipEnter)
        // https://codepen.io/lisaofalltrades/pen/jZyzKo
        pieMerge.on('mouseover', (d, index) => {
          tooltipMerge
            .text(d.data.competence)
            .style('box-shadow', `0 0 5px ${data[index].fill}`)
            .style('display', 'block')
          pathAnimate(d3Select(d3.event.target), 1)
        })
        pieMerge.on('mousemove', () => {
          tooltipMerge
            .style('top', (d3.event.layerY + 10) + 'px') // always 10px below the cursor
            .style('left', (d3.event.layerX + 10) + 'px'); // always 10px to the right of the mouse
        })
        pieMerge.on('mouseout', (d, index) => {
          tooltipMerge
            .style('display', 'none')
          pathAnimate(d3Select(d3.event.fromElement), 0)
        })
        pieMerge.on('click', (d) => {
          console.log('clicked!', d)
        })
      }
      function destroyChart (wrapper) {
        const {select: d3Select} = d3
        d3Select(wrapper).selectAll('*').remove()
      }
      document.addEventListener('DOMContentLoaded', () => {
        setInterval(() => {
          const random1 = Math.round(Math.random()*100)
          const random2 = Math.round(Math.random()*(100 - random1))
          const random3 = Math.round(Math.random()*(100 - random1 - random2))
          const random4 = 100 - random1 - random2 - random3
          renderChart(document.querySelector('#wrapper'), [
            { fill: '#d78dcb', value: random1, label: `${random1}%`, tooltip: `${random1}% Tooltip` },
            { fill: '#8abe6e', value: random2, label: `${random2}%`, tooltip: `${random2}% Tooltip` },
            { fill: '#5a98d5', value: random3, label: `${random3}%`, tooltip: `${random3}% Tooltip` },
            { fill: '#858585', value: random4, label: `${random4}%`, tooltip: `${random4}% Tooltip` },
          ])
        }, 5000)
        const random1 = Math.round(Math.random()*100)
        const random2 = Math.round(Math.random()*(100 - random1))
        const random3 = Math.round(Math.random()*(100 - random1 - random2))
        const random4 = 100 - random1 - random2 - random3
        renderChart(document.querySelector('#wrapper'), [
          { fill: '#d78dcb', value: random1, label: `${random1}%`, tooltip: `${random1}% Tooltip` },
          { fill: '#8abe6e', value: random2, label: `${random2}%`, tooltip: `${random2}% Tooltip` },
          { fill: '#5a98d5', value: random3, label: `${random3}%`, tooltip: `${random3}% Tooltip` },
          { fill: '#858585', value: random4, label: `${random4}%`, tooltip: `${random4}% Tooltip` },
        ])
      })
    
    </script>
  </body>
  </html>